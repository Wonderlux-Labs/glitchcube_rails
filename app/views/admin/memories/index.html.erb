<% content_for :layout, 'admin' %>

<h1>ðŸ§  Conversation Memories</h1>

<div style="margin-bottom: 20px;">
  <%= link_to 'All', admin_memories_path, class: 'btn' %>
  <% @memory_types.each do |type| %>
    <%= link_to "#{type.humanize} (#{@type_counts[type] || 0})", 
        admin_memories_path(type: type), class: 'btn' %>
  <% end %>
</div>

<div style="margin-bottom: 20px;">
  <%= form_with url: admin_memories_search_path, method: :get, local: true do |f| %>
    <%= f.text_field :q, placeholder: 'Search memories...', value: params[:q] %>
    <%= f.submit 'Search', class: 'btn' %>
  <% end %>
</div>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Summary</th>
      <th>Importance</th>
      <th>Session</th>
      <th>Created</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @memories.each do |memory| %>
      <tr>
        <td><%= memory.memory_type.humanize %></td>
        <td><%= memory.summary.truncate(100) %></td>
        <td>
          <span style="color: <%= memory.high_importance? ? '#00ff00' : memory.medium_importance? ? '#ffff00' : '#666' %>">
            <%= memory.importance %>/10
          </span>
        </td>
        <td><%= memory.session_id[0..8] %>...</td>
        <td><%= memory.created_at.strftime('%m/%d %H:%M') %></td>
        <td>
          <%= link_to 'View', admin_memory_path(memory), class: 'btn' %>
          <%= link_to 'Conversation', admin_conversation_path(memory.conversation), class: 'btn' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @memories.empty? %>
  <p style="color: #666; text-align: center; margin: 40px 0;">
    No memories found. Memories are created automatically from finished conversations.
  </p>
<% end %>