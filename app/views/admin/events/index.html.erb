<% content_for :layout, 'admin' %>

<h1>📅 Events</h1>

<div class="stats">
  <div class="stat-box">
    <h3>Total Events</h3>
    <p><%= @total_count %></p>
  </div>
  <div class="stat-box">
    <h3>Upcoming Events</h3>
    <p><%= @upcoming_count %></p>
  </div>
  <div class="stat-box">
    <h3>High Importance</h3>
    <p><%= @high_importance_count %></p>
  </div>
</div>

<div style="margin-bottom: 20px;">
  <%= form_with url: admin_events_path, method: :get, local: true, class: 'search-form' do |form| %>
    <%= form.text_field :search, placeholder: "Search events...", value: params[:search], style: "margin-right: 10px;" %>
    <%= form.select :type, options_for_select([['All Types', '']] + @event_types.map { |t| [t.humanize, t] }, params[:type]), {}, style: "margin-right: 10px;" %>
    <%= form.select :importance, options_for_select([['All Importance', ''], ['High (7-10)', 'high'], ['Medium (4-6)', 'medium'], ['Low (1-3)', 'low']], params[:importance]), {}, style: "margin-right: 10px;" %>
    <%= form.select :status, options_for_select([['All Status', ''], ['Upcoming', 'upcoming'], ['Past', 'past']], params[:status]), {}, style: "margin-right: 10px;" %>
    <%= form.submit "Filter", class: 'btn' %>
    <%= link_to 'Clear', admin_events_path, class: 'btn' %>
  <% end %>
</div>

<div style="margin-bottom: 20px;">
  <%= link_to 'All Events', admin_events_path, class: 'btn' %>
  <%= link_to 'Upcoming', admin_events_path(status: 'upcoming'), class: 'btn' %>
  <%= link_to 'Past', admin_events_path(status: 'past'), class: 'btn' %>
  <%= link_to 'High Importance', admin_events_path(importance: 'high'), class: 'btn' %>
  <%= link_to 'Timeline View', timeline_admin_events_path, class: 'btn' %>
</div>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Event Time</th>
      <th>Location</th>
      <th>Importance</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><strong><%= event.title %></strong></td>
        <td><%= truncate(event.description, length: 80) %></td>
        <td>
          <%= event.formatted_time %>
          <% if event.upcoming? %>
            <br><small style="color: #00ffff;"><%= event.hours_until_event %>h remaining</small>
          <% end %>
        </td>
        <td><%= event.location&.truncate(30) || 'No location' %></td>
        <td>
          <span style="color: <%= event.high_importance? ? '#ff0000' : event.importance >= 4 ? '#ffff00' : '#00ff00' %>;">
            <%= event.importance %>/10
          </span>
        </td>
        <td class="<%= event.upcoming? ? 'active-status' : 'finished-status' %>">
          <%= event.upcoming? ? 'Upcoming' : 'Past' %>
        </td>
        <td>
          <%= link_to 'View', admin_event_path(event), class: 'btn' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @events.respond_to?(:total_pages) %>
  <div style="margin-top: 20px;">
    Page <%= @events.current_page %> of <%= @events.total_pages %>
    <% if @events.prev_page %>
      <%= link_to '← Previous', admin_events_path(page: @events.prev_page), class: 'btn' %>
    <% end %>
    <% if @events.next_page %>
      <%= link_to 'Next →', admin_events_path(page: @events.next_page), class: 'btn' %>
    <% end %>
  </div>
<% end %>