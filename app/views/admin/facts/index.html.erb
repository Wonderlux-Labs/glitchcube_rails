<% content_for :layout, 'admin' %>

<h1>üîç Facts</h1>

<div class="stats">
  <div class="stat-box">
    <h3>Total Facts</h3>
    <p><%= @total_count %></p>
  </div>
  <div class="stat-box">
    <h3>High Importance</h3>
    <p><%= @high_importance_count %></p>
  </div>
  <div class="stat-box">
    <h3>Recent Facts</h3>
    <p><%= @recent_count %></p>
    <small style="color: #666;">last 7 days</small>
  </div>
</div>

<div style="margin-bottom: 20px;">
  <%= form_with url: admin_facts_path, method: :get, local: true, class: 'search-form' do |form| %>
    <%= form.text_field :search, placeholder: "Search facts...", value: params[:search], style: "margin-right: 10px;" %>
    <%= form.select :importance, options_for_select([['All Importance', ''], ['High (7-10)', 'high'], ['Medium (4-6)', 'medium'], ['Low (1-3)', 'low']], params[:importance]), {}, style: "margin-right: 10px;" %>
    <%= form.submit "Filter", class: 'btn' %>
    <%= link_to 'Clear', admin_facts_path, class: 'btn' %>
  <% end %>
</div>

<div style="margin-bottom: 20px;">
  <%= link_to 'All Facts', admin_facts_path, class: 'btn' %>
  <%= link_to 'High Importance', admin_facts_path(importance: 'high'), class: 'btn' %>
  <%= link_to 'Recent', admin_facts_path, class: 'btn' %>
</div>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Content</th>
      <th>Importance</th>
      <th>Created</th>
      <th>Updated</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @facts.each do |fact| %>
      <tr>
        <td><%= fact.id %></td>
        <td>
          <% if fact.respond_to?(:content) && fact.content.present? %>
            <%= truncate(fact.content, length: 150) %>
          <% elsif fact.respond_to?(:title) && fact.title.present? %>
            <%= truncate(fact.title, length: 150) %>
          <% else %>
            <em style="color: #666;">Fact #<%= fact.id %> - Content not available</em>
          <% end %>
        </td>
        <td>
          <% if fact.respond_to?(:importance) && fact.importance.present? %>
            <% importance = fact.importance.to_i %>
            <span style="color: <%= importance >= 7 ? '#ff0000' : importance >= 4 ? '#ffff00' : '#00ff00' %>;">
              <%= importance %>/10
            </span>
          <% else %>
            <span style="color: #666;">N/A</span>
          <% end %>
        </td>
        <td><%= fact.created_at.strftime('%m/%d %H:%M') %></td>
        <td><%= fact.updated_at.strftime('%m/%d %H:%M') %></td>
        <td>
          <%= link_to 'View', admin_fact_path(fact), class: 'btn' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @facts.empty? %>
  <div style="background: #2a2a2a; padding: 20px; border: 1px solid #444; text-align: center; margin-top: 20px;">
    <p style="color: #666;">No facts found.</p>
    <% if params[:search].present? || params[:importance].present? %>
      <%= link_to 'Clear Filters', admin_facts_path, class: 'btn' %>
    <% end %>
  </div>
<% end %>

<% if @facts.respond_to?(:total_pages) %>
  <div style="margin-top: 20px;">
    Page <%= @facts.current_page %> of <%= @facts.total_pages %>
    <% if @facts.prev_page %>
      <%= link_to '‚Üê Previous', admin_facts_path(page: @facts.prev_page), class: 'btn' %>
    <% end %>
    <% if @facts.next_page %>
      <%= link_to 'Next ‚Üí', admin_facts_path(page: @facts.next_page), class: 'btn' %>
    <% end %>
  </div>
<% end %>