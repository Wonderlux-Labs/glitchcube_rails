---
http_interactions:
- request:
    method: post
    uri: https://openrouter.helicone.ai/api/v1/chat/completions
    body:
      encoding: UTF-8
      string: '{"messages":[{"role":"system","content":"You are a technical tool execution
        service. Your job is to translate natural language intent into precise tool
        calls.\n\nUSER INTENT: Set lights to magenta at 75% brightness\n\nCONTEXT:
        {}\n\nIMPORTANT RULES:\n- Use EXACT parameter names from tool definitions\n-
        For colors: use rgb_color parameter with [R, G, B] values (0-255)\n- For brightness:
        use brightness_percent parameter (0-100)\n- Common color translations:\n  *
        red: [255, 0, 0]\n  * green: [0, 255, 0] \n  * blue: [0, 0, 255]\n  * magenta:
        [255, 0, 255]\n  * yellow: [255, 255, 0]\n  * white: [255, 255, 255]\n  *
        orange: [255, 165, 0]\n  * purple: [128, 0, 128]\n\nMake the precise tool
        calls needed to fulfill the intent.\n"},{"role":"user","content":"Execute
        this intent: Set lights to magenta at 75% brightness"}],"model":"gpt-4o-mini","tools":[{"type":"function","function":{"name":"turn_on_light","description":"Turn
        on cube lights (cube_light, cube_voice_ring, or specific cube segments)","parameters":{"type":"object","properties":{"entity_id":{"type":"string","description":"Light
        entity to turn on","enum":["light.cube_voice_ring","light.cube_light_top","light.cube_inner"]},"transition":{"type":"number","description":"Transition
        time in seconds (optional)","minimum":0,"maximum":300}},"required":["entity_id"]}}},{"type":"function","function":{"name":"turn_off_light","description":"Turn
        off cube lights (cube_light, cube_voice_ring, or specific cube segments)","parameters":{"type":"object","properties":{"entity_id":{"type":"string","description":"Light
        entity to turn off","enum":["light.cube_voice_ring","light.cube_light_top","light.cube_inner"]},"transition":{"type":"number","description":"Transition
        time in seconds (optional)","minimum":0,"maximum":300}},"required":["entity_id"]}}},{"type":"function","function":{"name":"set_light_color_and_brightness","description":"Set
        color and/or brightness for cube lights. Can set color only, brightness only,
        or both.","parameters":{"type":"object","properties":{"entity_id":{"type":"string","description":"Light
        entity to control","enum":["light.cube_voice_ring","light.cube_light_top","light.cube_inner"]},"rgb_color":{"type":"array","description":"RGB
        color as array of 3 integers (0-255). Example: [255, 0, 0] for red","items":{"type":"integer","minimum":0,"maximum":255}},"brightness_percent":{"type":"number","description":"Brightness
        as percentage (0-100). Example: 75 for 75% brightness","minimum":0,"maximum":100},"transition":{"type":"number","description":"Transition
        time in seconds (optional)","minimum":0,"maximum":300}},"required":["entity_id"]}}},{"type":"function","function":{"name":"set_light_effect","description":"Set
        lighting effects on cube lights that support them","parameters":{"type":"object","properties":{"entity_id":{"type":"string","description":"Light
        entity to control","enum":["light.cube_voice_ring","light.cube_light_top","light.cube_inner"]},"effect":{"type":"string","description":"Effect
        name to apply (use list_light_effects to see available options)"},"transition":{"type":"number","description":"Transition
        time in seconds (optional)","minimum":0,"maximum":300}},"required":["entity_id","effect"]}}},{"type":"function","function":{"name":"list_light_effects","description":"List
        available effects for cube lights","parameters":{"type":"object","properties":{"entity_id":{"type":"string","description":"Light
        entity to check for available effects","enum":["light.cube_voice_ring","light.cube_light_top","light.cube_inner"]}},"required":["entity_id"]}}},{"type":"function","function":{"name":"get_light_state","description":"Get
        current state, brightness, color, and available effects of cube lights. Shows
        all possible effects that can be set.","parameters":{"type":"object","properties":{"entity_id":{"type":"string","description":"Light
        entity to check","enum":["light.cube_voice_ring","light.cube_light_top","light.cube_inner"]}},"required":["entity_id"]}}},{"type":"function","function":{"name":"display_notification","description":"Display
        text notification on the Awtrix matrix display via MQTT script","parameters":{"type":"object","properties":{"text":{"type":"string","description":"Text
        message to display on the matrix"},"duration":{"type":"number","description":"How
        long to display the message in seconds (default: 5)","minimum":1,"maximum":60},"color":{"type":"string","description":"Text
        color (e.g., ''red'', ''green'', ''blue'', ''white'', ''yellow'')"},"icon":{"type":"string","description":"Icon
        to display with the text (optional)"}},"required":["text"]}}},{"type":"function","function":{"name":"play_music","description":"Play
        music on the Cube''s jukebox with fuzzy search - can search by song, artist,
        or any combination","parameters":{"type":"object","properties":{"media_id":{"type":"string","description":"REQUIRED:
        The song you want to play - fuzzy search works, so can do ''Watermelon Man
        by Herbie Hancock'' or ''Nirvana - Teen Spirit''. The more precise the better."},"artist":{"type":"string","description":"Optional:
        Artist name to narrow down search results if getting funny results"},"album":{"type":"string","description":"Optional:
        Album name to further narrow down search if needed"},"enqueue":{"type":"string","description":"Queue
        mode: ''play'' (force play now), ''replace'' (replace queue and play), ''next''
        (add after current), ''replace_next'' (default), ''add'' (end of queue)","enum":["play","replace","next","replace_next","add"]}},"required":["media_id"]}}},{"type":"function","function":{"name":"control_effects","description":"Control
        brief environmental effects like fan, strobe lighting, blacklight, and siren
        (all auto-toggle off)","parameters":{"type":"object","properties":{"effect":{"type":"string","description":"Effect
        to control","enum":["fan","strobe","blacklight","siren"]},"action":{"type":"string","description":"Action
        to perform (on/off/toggle)","enum":["on","off","toggle"]}},"required":["effect","action"]}}},{"type":"function","function":{"name":"make_announcement","description":"Make
        spoken announcements using music_assistant with persona voice and optional
        Awtrix display","parameters":{"type":"object","properties":{"message":{"type":"string","description":"Message
        to speak aloud"},"display_text":{"type":"string","description":"Optional text
        to display on Awtrix matrix (if different from spoken message)"},"volume":{"type":"number","description":"Volume
        level for announcement (0-100)","minimum":0,"maximum":100},"voice":{"type":"string","description":"Voice
        to use (will default to current persona voice)"}},"required":["message"]}}},{"type":"function","function":{"name":"mode_control","description":"Control
        special operational modes of the Cube (emergency, stealth, theme song)","parameters":{"type":"object","properties":{"mode":{"type":"string","description":"Mode
        to control","enum":["emergency_mode","stealth_mode","play_theme_song"]},"action":{"type":"string","description":"Action
        to perform","enum":["activate","deactivate","toggle"]}},"required":["mode","action"]}}}],"tool_choice":"auto","temperature":0.1,"max_tokens":12000}'
    headers:
      Authorization:
      - Bearer <OPENROUTER_API_KEY>
      Content-Type:
      - application/json
      X-Title:
      - OpenRouter Ruby Client
      Http-Referer:
      - https://github.com/OlympiaAI/open_router
      Helicone-Auth:
      - Bearer sk-helicone-3ecehsq-ix6eiiy-x4kivhi-rxz2hoa
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 18 Aug 2025 13:36:08 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Cf-Ray:
      - 9711cc50dcef72ea-ORD
      Access-Control-Allow-Origin:
      - "*"
      Vary:
      - Accept-Encoding
      Helicone-Id:
      - 62c00967-97db-4434-8ff1-103306f05ed2
      Helicone-Status:
      - success
      Permissions-Policy:
      - payment=(self "https://checkout.stripe.com" "https://connect-js.stripe.com"
        "https://js.stripe.com" "https://*.js.stripe.com" "https://hooks.stripe.com")
      Referrer-Policy:
      - no-referrer, strict-origin-when-cross-origin
      X-Content-Type-Options:
      - nosniff
      Server:
      - cloudflare
    body:
      encoding: ASCII-8BIT
      string: "\n         \n\n         \n\n         \n\n         \n\n         \n\n
        \        \n\n         \n{\"id\":\"gen-1755524165-LSfQLDzU0JHuEeQMFHYR\",\"provider\":\"OpenAI\",\"model\":\"openai/gpt-4o-mini\",\"object\":\"chat.completion\",\"created\":1755524165,\"choices\":[{\"logprobs\":null,\"finish_reason\":\"tool_calls\",\"native_finish_reason\":\"tool_calls\",\"index\":0,\"message\":{\"role\":\"assistant\",\"content\":\"\",\"refusal\":null,\"reasoning\":null,\"tool_calls\":[{\"index\":0,\"id\":\"call_eGYtwYHQnLB9apdKb1zumB1w\",\"type\":\"function\",\"function\":{\"name\":\"set_light_color_and_brightness\",\"arguments\":\"{\\\"entity_id\\\":
        \\\"light.cube_light_top\\\", \\\"rgb_color\\\": [255, 0, 255], \\\"brightness_percent\\\":
        75}\"}},{\"index\":1,\"id\":\"call_XYc8gzftrjdE7gaAhgrGwirP\",\"type\":\"function\",\"function\":{\"name\":\"set_light_color_and_brightness\",\"arguments\":\"{\\\"entity_id\\\":
        \\\"light.cube_voice_ring\\\", \\\"rgb_color\\\": [255, 0, 255], \\\"brightness_percent\\\":
        75}\"}},{\"index\":2,\"id\":\"call_R3tORALwZkKw14VEteJE1egs\",\"type\":\"function\",\"function\":{\"name\":\"set_light_color_and_brightness\",\"arguments\":\"{\\\"entity_id\\\":
        \\\"light.cube_inner\\\", \\\"rgb_color\\\": [255, 0, 255], \\\"brightness_percent\\\":
        75}\"}}]}}],\"system_fingerprint\":\"fp_560af6e559\",\"usage\":{\"prompt_tokens\":1351,\"completion_tokens\":126,\"total_tokens\":1477,\"prompt_tokens_details\":{\"cached_tokens\":0,\"audio_tokens\":0},\"completion_tokens_details\":{\"reasoning_tokens\":0}}}"
  recorded_at: Mon, 18 Aug 2025 13:36:08 GMT
recorded_with: VCR 6.3.1
