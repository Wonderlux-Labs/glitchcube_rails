---
# AWTRIX Custom Apps for GlitchCube
# Three rotating apps: Location Context, Weather Info, and "HEY GLITCH CUBE!" Alert

# App 1: Location Context Display
- id: 'awtrix_location_context'
  alias: "AWTRIX Location Context"
  description: "Shows current location with time context and coordinates"
  triggers:
  - trigger: time_pattern
    minutes: "/5"  # Update every 5 minutes
  - trigger: state
    entity_id: input_text.current_location
  - trigger: state
    entity_id: sun.sun
  conditions: []
  actions:
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: location
      text: "üìç {{ states('input_text.current_location') }} - {{ now().strftime('%I:%M %p') }}"
      icon: 7786
      color: "{% set hour = now().hour %}{% if hour < 6 %}#6464FF{% elif hour < 12 %}#FFC800{% elif hour < 17 %}#FF9600{% elif hour < 21 %}#FF6400{% else %}#C800FF{% endif %}"
      duration: 12
      scrollSpeed: 85
      textCase: 1
      center: true
  mode: single

# App 2: Weather Information Display  
- id: 'awtrix_weather_info'
  alias: "AWTRIX Weather Info"
  description: "Dynamic weather display with current conditions"
  triggers:
  - trigger: time_pattern
    minutes: "/10"  # Update every 10 minutes
  - trigger: state
    entity_id: weather.playaweather
  - trigger: state
    entity_id: weather.pirateweather
  conditions: []
  actions:
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: weather
      text: "üå§Ô∏è {{ state_attr('weather.playaweather', 'temperature') | int }}¬∞F H{{ state_attr('weather.playaweather', 'humidity') }}% W{{ state_attr('weather.playaweather', 'wind_speed') | round(1) }}mph"
      icon: "{% set condition = states('weather.playaweather') %}{% if condition == 'sunny' %}a2282{% elif condition == 'clear-night' %}a2283{% elif condition == 'partlycloudy' %}a2284{% elif condition == 'cloudy' %}a2285{% elif condition == 'rainy' %}a2286{% elif condition == 'snowy' %}a2287{% else %}a2282{% endif %}"
      color: "{% set temp = state_attr('weather.playaweather', 'temperature') | int %}{% if temp < 70 %}#0096FF{% elif temp < 80 %}#00FF64{% elif temp < 90 %}#FFFF00{% elif temp < 100 %}#FF9600{% else %}#FF0000{% endif %}"
      duration: 15
      scrollSpeed: 75
      center: false
  mode: single

# App 3: "HEY GLITCH CUBE!" Alert Display
- id: 'awtrix_glitch_cube_alert'
  alias: "AWTRIX Glitch Cube Alert"
  description: "Fun animated notification with HEY GLITCH CUBE message"
  triggers:
  - trigger: time_pattern
    minutes: "/3"  # Show every 3 minutes for fun
  - trigger: state
    entity_id: input_select.current_persona
  - trigger: state
    entity_id: counter.daily_conversations
  conditions: []
  actions:
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: hey_glitch
      text: "üéâ HEY GLITCH CUBE! üéâ"
      icon: "{% set persona = states('input_select.current_persona') %}{% if persona == 'buddy' %}2022{% elif persona == 'jax' %}7956{% elif persona == 'lomi' %}7919{% elif persona == 'zorp' %}7982{% else %}7786{% endif %}"
      rainbow: true
      effect: "BlinkyRainbow"
      duration: 8
      scrollSpeed: 100
      center: false
  mode: single

# Bonus App: System Status Display
- id: 'awtrix_system_status'
  alias: "AWTRIX System Status"
  description: "Shows current persona and conversation count"
  triggers:
  - trigger: state
    entity_id: input_select.current_persona
  - trigger: state
    entity_id: counter.daily_conversations
  - trigger: time_pattern
    minutes: "/15"  # Update every 15 minutes
  conditions: []
  actions:
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: status
      text: "ü§ñ {{ states('input_select.current_persona').upper() }} - {{ states('counter.daily_conversations') }} CHATS"
      icon: "{% set persona = states('input_select.current_persona') %}{% if persona == 'buddy' %}2022{% elif persona == 'jax' %}7956{% elif persona == 'lomi' %}7919{% elif persona == 'zorp' %}7982{% else %}7786{% endif %}"
      color: "{% set persona = states('input_select.current_persona') %}{% if persona == 'buddy' %}#00C8FF{% elif persona == 'jax' %}#FF6400{% elif persona == 'lomi' %}#FF00C8{% elif persona == 'zorp' %}#64FF00{% else %}#FFFFFF{% endif %}"
      duration: 15
      scrollSpeed: 80
      center: false
  mode: single

# Manual Trigger for HEY GLITCH CUBE Alert
- id: 'awtrix_manual_hey_glitch'
  alias: "AWTRIX Manual Hey Glitch"
  description: "Manually trigger HEY GLITCH CUBE alert via input button"
  triggers:
  - trigger: state
    entity_id: input_button.cycle_persona
  conditions: []
  actions:
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: hey_glitch
      text: "üö® HEY GLITCH CUBE! üö® PERSONA SWITCH!"
      icon: 7982
      rainbow: true
      effect: "BlinkyRainbow"
      duration: 10
      scrollSpeed: 120
      center: false
  mode: single

# Clear Apps on Demand (for testing)
- id: 'awtrix_clear_apps'
  alias: "AWTRIX Clear All Apps"  
  description: "Clear all custom AWTRIX apps when maintenance mode enabled"
  triggers:
  - trigger: state
    entity_id: input_boolean.maintenance_mode
    to: 'on'
  conditions: []
  actions:
  # Clear apps by setting empty text
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: location
      text: ""
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: weather
      text: ""
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: hey_glitch
      text: ""
  - service: awtrix.custom_app
    data:
      device: ac07cb1bceee39dce3af75aa6c6d784c
      app: status
      text: ""
  mode: single

# LaMetric/AWTRIX Icon Reference:
# Weather Icons (using LaMetric format "a" prefix for animated):
# a2282: Sunny/Clear Day, a2283: Clear Night, a2284: Partly Cloudy
# a2285: Cloudy, a2286: Rain, a2287: Snow
# 
# System Icons:
# 183: Battery Full, 184: Battery Low
# 4687: Check mark, 4688: X mark  
# 7876: Motion sensor, 7786: Gear/settings
# 
# Persona/Character Icons:
# 2022: Buddy face, 7956: Jax, 7919: Lomi, 7982: Zorp
# 7953: Location pin, 7929: Chat bubble
#
# Burning Man/Desert Themed Icons (potential additions):
# 1000+: Desert/cactus themes, fire icons, music/party icons
# Check https://developer.lametric.com/icons for more

# Available Effects:
# BlinkyRainbow, ColorWipe, TheaterChase, Fireworks, Rain, Snake

# Usage Notes:
# - Device ID: ac07cb1bceee39dce3af75aa6c6d784c targets specific AWTRIX device
# - Apps update in real-time when Home Assistant sensors change
# - Location app shows current position with time-based colors
# - Weather app displays temperature, humidity, wind with animated weather icons
# - HEY GLITCH CUBE app provides fun animated alerts with persona colors
# - System handles app cycling via AWTRIX device settings
# - Manual triggers available for testing and interaction